# 热修复方案理解

热修复指的是在不发版的前提下修复代码问题。注意，Android上无法实现类卸载。

- 热启动热Java层修复
- 热启动底层替换修复
- 冷启动热修复
- 资源热修复

## 热启动修复

### Java层热启动修复

提前在修复点打桩，根据后台下发修复情况，下载不同的远程dex等文件，下载完成后即可加载，变更前端逻辑。加载调用协议需要提前规定设计。

### 底层热启动修复

以art虚拟机为例，依靠jni，通过更改artMethod信息，即代码的访问权限、执行地址等，使得在不破坏原有代码方法调用上，使用了新的方法实现等。

- Andfix使用此方案
- 如果厂家定制了不同的art实现，那么此方案会出现兼容性问题
- 实际上有一些后来的Hook方案，不依赖类似Xposed框架，其实现原理也是如此，通过jni对artMethod进行修改，在hook点上调用了自己的Hook方法。

## 冷启动热修复

- 也可以同前面第一个方案，下载远程的dex文件后，在下次启动时加载。
- 修复方案提供差量dex文件，修复方案通过将其与当前的dex合并，之后在下次启动时即可加载了新的dex文件。

## 资源热修复

可参见插件化方案理解中的资源插件方案。